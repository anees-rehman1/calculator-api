# Name of your workflow (shows in GitHub UI)
name: CI Pipeline

# WHEN should this run? (on push to main branch OR pull request)
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# WHAT jobs should run?
jobs:
  # Job 1: Run tests
  test:
    # WHERE should it run? (GitHub provides free Ubuntu servers)
    runs-on: ubuntu-latest
    
    # STEPS - What to do, in order
    steps:
    # Step 1: Get the code from GitHub
    - name: Checkout code
      uses: actions/checkout@v4  # This is an ACTION (pre-built code)
    
    # Step 2: Setup Node.js
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'  # Use Node.js version 18
    
    # Step 3: Install dependencies
    - name: Install dependencies
      run: npm ci  # RUN is for shell commands
    
    # Step 4: Run tests
    - name: Run tests
      run: npm test
    
    # Step 5: Check if server starts
    - name: Test server starts
      run: |
        npm start &
        sleep 5
        curl -f http://localhost:3000/health
